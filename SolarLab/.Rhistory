library(ggplot2)
library(openintro)
data(COL)
dave<-0.7
carole<-0.6
size<-100
x<-seq(1,size)
dat<-data.frame(x,d=dbinom(x,size,dave),c=dbinom(x,size,carole))
g<-ggplot(data=dat,aes(x=x,y=d))+geom_bar(stat="identity",aes(width=0.4,col = COL[22]))
g
g<-ggplot(data=dat,aes(x=x,y=d))+geom_bar(stat="identity",aes(width=0.4,col = COL[1],fill=COL[1]))
g
g<-ggplot(data=dat,aes(x=x,y=d))+geom_bar(stat="identity",aes(width=0.4,col = COL[2],fill=COL[2]))
g
g<-ggplot(data=dat,aes(x=x))+geom_bar(stat="bin",aes(width=0.4,col = COL[2],fill=COL[2]))
g
g<-ggplot(data=dat,aes(x=x,y=d))+geom_bar(stat="bin",aes(width=0.4,col = COL[2],fill=COL[2]))
g
library(ggplot2)
g<-ggplot(data=dat,aes(x=x,y=d))+geom_bar(stat="identity",aes(width=0.4,col = COL[2],fill=COL[2]))
g
g<-ggplot(data=dat,aes(x=x,y=d))+geom_bar(stat="identity",aes(width=0.4,col = COL[7],fill=COL[7]))
g
?COL()
g<-ggplot(data=dat,aes(x=x,y=d))+geom_bar(stat="identity",aes(width=0.4,colour = COL[7],fill=COL[7]))
g
g<-ggplot(data=dat,aes(x=x,y=d,fill=COL[7]))+geom_bar(stat="identity",aes(width=0.4,colour = COL[7],fill=COL[7]))
g
g<-ggplot(data=dat,aes(x=x,y=d,fill=COL[7]))+geom_bar(stat="identity",aes(width=0.4,colour = COL[7]))
g
g<-ggplot(data=dat,aes(x=x,y=d,fill=COL[7]))+geom_bar(stat="identity",aes(width=0.4,colour = COL[7],alpha=0.5))
g
g<-ggplot(data=dat,aes(x=x,y=d,fill=COL[7]))+geom_bar(stat="identity",aes(width=0.4,colour = COL[7],alpha=0.3))
g
?Rmarkdown
?markdown
knit_engines$set()
?cat
qnorm(-3.7,0,1.7)
pnorm(-3.7,0,1.7)
?swirl
install.packages("swirl")
library(swirl)
ls()
rm(list=ls())
ls()
swirl()
?InstallCourses
install_from_swirl(Getting and Cleaning Data, dev = FALSE, mirror = "github")
install_from_swirl(Getting_and_Cleaning_Data, dev = FALSE, mirror = "github")
SWIRL()
swirl()
7/(200000/10000)
7/(10000/200000)
setwd("H:/Rspace/SU-SL/R_sessions")
set.seed(101)
x=matrix(rnorm(100*2),100,2)
xmean=matrix(rnorm(8,sd=4),4,2)
x
xmean
which=sample(1:4,100,replace=TRUE)
which
apply(USArrests,2,mean)
dimnames(USArrests)
apply(USArrests,2,mean)
apply(USArrests,2, var)
pca.out=prcomp(USArrests, scale=TRUE)
pca.out
names(pca.out)
biplot(pca.out, scale=0,cex=0.6)
source('~/.active-rstudio-document')
setwd("H:/Rspace/SU-SL/R_sessions")
load ("./data/10.R.RData")
rm(list=ls())
load ("./data/10.R.RData")
xall<-rbind(x,xtest)
pca.out=prcomp(xall, scale=TRUE)
pca.out
names(pca.out)
biplot(pca.out, scale=0,cex=0.6)
xall<-rbind(x,x.test)
pca.out=prcomp(xall, scale=TRUE)
pca.out
names(pca.out)
biplot(pca.out, scale=0,cex=0.6)
pca.out
summary(pca.out)
?prcomp
xall<-rbind(x,x.test)
pca.out=prcomp(xall, scale=TRUE)
summary(pca.out)
names(pca.out)
biplot(pca.out, scale=0,cex=0.6)
vars = prcomp(rbind(x,x.test),scale=TRUE)$sdev^2
vars
require(caret)
trans = preProcess(xall,
method=c("BoxCox", "center",
"scale", "pca"))
PC = predict(trans,y)
install.packages("pbkrtest")
require(caret)
trans = preProcess(xall,
trans = preProcess(xall, method=c("BoxCox", "center", "scale", "pca"))
PC = predict(trans,y)
str(pac.out)
str(pca.out)
summary(pca.out)
pca.out$sdev
pca.out$sdev
pca.out$pvar
names(pca.out)
pac.out$rotation
pca.out$rotation
pca.out$sdev
pca.out$sdev^2
sum(pca.out$sdev^2)
sum(pca.out$sdev^2[1:5])/sum(pca.out$sdev^2)
sum(pca.out$sdev^2)/sum(pca.out$sdev^2)
sum(pca.out$sdev^2[1:5])/sum(pca.out$sdev^2)
sum(pca.out$sdev[1:5]^2)/sum(pca.out$sdev^2)
pca.out[1:5]
summary(pca.out[1:5])
pca.out$rotation
pca.out$rotation[,1:5]
pca.var<-pca.out$sdev^2
pve=pca.var/sum(pca.var)
pve[1:10]
cpve<-cumsum(pve)
cpve[1:10]
plot(cpve,xlab="Principal Component",ylab="Cumulative Proportion of Variance Explained",ylim=c(0,1),type="b")
plot(cpve,xlab="Principal Component",ylab="Cumulative Proportion of Variance Explained",ylim=c(0,1),type='b')
plot(pve,xlab="Principal Component",ylab="Proportion of Variance Explained",ylim=c(0,1),type='b')
plot(pve[1:10],xlab="Principal Component",ylab="Proportion of Variance Explained",ylim=c(0,1),type='b')
plot(pve[1:10],xlab="Principal Component",ylab="Proportion of Variance Explained",ylim=c(0,0.2),type='b')
plot(cpve,xlab="Principal Component",ylab="Cumulative Proportion of Variance Explained",ylim=c(0,1),type='b')
pca.out$coefs
names(pca.out)
plot(pca.out,type="l")
yfit<-lm(y~pca.out)
yfit<-lm(y~pca.out$rotation[1;5])
yfit<-lm(y~pca.out$rotation[1:5])
a<-c(1,2,3,4,5)
b<-matrix(rep(1,25),5,5)
b
a*b
b*t(a)
b%*%t(a)
b %*% t(a)
b %*% a
z<-xall*pca.out$rotation[1:5]
str(z)
z[1]
yfit<-lm(y~z)
str(z)
dim(z)
z<-y*pca.out$rotation[1:5]
yfit<-lm(y~z)
summary(yfit)
dim(z)
z
pca.out$rotation[1:5]
xall<-rbind(x,x.test)
pca.out=prcomp(xall, scale=TRUE)
summary(pca.out)
plot(pca.out,type="l")
pca.var<-pca.out$sdev^2
pve=pca.var/sum(pca.var)
pve[1:10]
plot(pve[1:10],xlab="Principal Component",ylab="Proportion of Variance Explained",ylim=c(0,0.2),type='b')
cpve<-cumsum(pve)
cpve[1:10]
plot(cpve,xlab="Principal Component",ylab="Cumulative Proportion of Variance Explained",ylim=c(0,1),type='b')
names(pca.out)
pca.out$rotation[1:5]
pca.out$rotation[1:5][1]
class(pca.out$rotation)
dim(pca.out$rotation)
yfit<-lm(y~pca.out$rotation[1:5])
z<-y*pca.out$rotation[,1:5]
length(y)
length(x)
length(x.test)
str(x)
str(y)
dim(x.text)
dim(x.test)
dim(y.test)
str(y.test)
str(pca.out$rotation)
x %*% pca.out
str(pca.out)
x %*% pca.out$rotation
class(pca.out$rotation)
class(x)
xmat<-as.matrix(x)
str(xmat)
xmat %*% pca.out$rotation
z<-xmat %*% pca.out$rotation
str(z)
xmat<-as.matrix(x)
z<-xmat %*% pca.out$rotation
yfit<-lm(y~z[,1:5])
ypred<-predict(yfit,newdata=y.test)
summary(yfit)
ypred<-predict(yfit,newdata=x.test)
x.testmat<-as.matrix(x.test)
z.test<-x.testmat %*% pca.out$rotation
y.pred=predict(yfit,newdata=z.test)
z.test<-as.data.frame(x.testmat %*% pca.out$rotation)
y.pred=predict(yfit,newdata=z.test)
str(y.pred)
str(z.test)
y.pred=predict(yfit,newdata=z.test[1:5])
summRY(yfit)
summARY(yfit)
summARY(yfit)
summary(yfit)
yfit$coefficients
z.test<-as.data.frame(x.testmat %*% pca.out$rotation)
z.test<-x.testmat %*% pca.out$rotation
class(yfit$coefficients)
ypred<-yfit$coefficients[1]+z.test %*% yfit$coefficients[2:6]
ypred<-yfit$coefficients[1]+z.test[,1:5] %*% yfit$coefficients[2:6]
sum((ypred-y.test)^2)/length(y.test)
ypred<-yfit$coefficients[1]+z.test[,1:5] %*% yfit$coefficients[2:6]
mse<-sum((ypred-y.test)^2)/length(y.test)
mse
yfitOLS<-lm(y~x)
yfit<-lm(y~z[,1:5],data=z)
xall<-rbind(x,x.test)
pca.out=prcomp(xall, scale=TRUE)
summary(pca.out)
# plot variance associated with each PC
plot(pca.out,type="l")
pca.var<-pca.out$sdev^2
pve=pca.var/sum(pca.var)
pve[1:10]
plot(pve[1:10],xlab="Principal Component",ylab="Proportion of Variance Explained",ylim=c(0,0.2),type='b')
cpve<-cumsum(pve)
cpve[1:10]
plot(cpve,xlab="Principal Component",ylab="Cumulative Proportion of Variance Explained",ylim=c(0,1),type='b')
names(pca.out)
biplot(pca.out, scale=0,cex=0.6)
xmat<-as.matrix(x)
z<-xmat %*% pca.out$rotation
z<-data.frame(z)
yfit<-lm(y~z[,1:5],data=z)
str(z)
yfit<-lm(y~PC1+PC2+PC3+PC4+PC5,data=z)
x.testmat<-as.matrix(x.test)
z.test<-x.testmat %*% pca.out$rotation
ypred<-yfit$coefficients[1]+z.test[,1:5] %*% yfit$coefficients[2:6]
mse<-sum((ypred-y.test)^2)/length(y.test)
mse
yfitOLS<-lm(y~.,data=x)
yfitOLSpred<-predict(yfitOLS,newdata=x.test)
yfitOLS<-lm(y~.,data=x)
yfitOLSpred<-predict(yfitOLS,newdata=x.test)
mse<-sum((yfitOLSpred-y.test)^2)/length(y.test)
mse
ypred<-predict(yfit,newdata=x.test)
yfit<-lm(y~PC1+PC2+PC3+PC4+PC5,data=z)
ypred<-predict(yfit,newdata=x.test)
yfit<-lm(y~PC1+PC2+PC3+PC4+PC5,data=z)
x.testmat<-as.matrix(x.test)
z.test<-x.testmat %*% pca.out$rotation
ypred<-predict(yfit,newdata=z.test)
z.test<-as.data.frame(z.test)
ypred<-predict(yfit,newdata=z.test)
mse<-sum((ypred-y.test)^2)/length(y.test)
mse
mse(ypred,ytest)
library(hyroGOF)
install.packages("hydroGOF")
library(hyroGOF)
library(hydroGOF)
mse(ypred,ytest)
mse(ypred,y.test)
mse(ypred,y.test)
mse(yfitOLSpred,y.test)
setwd("H:/Rspace/RE_Community/SolarLab")
Cam2001<- read.table("./data/project_label_BSRN_event_label_CAM_2001.tab",sep="\t", header=TRUE)
rm(list=ls())
Cam2001<- read.table("./data/project_label_BSRN_event_label_CAM_2001.tab",sep="\t", header=TRUE)
str(Cam2001)
setwd("H:/Rspace/RE_Community")
library(dplyr)
library(ggplot2)
library(tidyr)
library(lubridate)
## read in data
dat.wide<-read.csv("callywith3year.csv",stringsAsFactors=FALSE)
str(dat.wide)
dat.wide<-read.csv("callywith3year.csv")#,stringsAsFactors=FALSE)
str(dat.wide)
Cam2001<- read.table("./data/project_label_BSRN_event_label_CAM_2001.tab",sep="\t", header=TRUE,stringsAsFactors=FALSE)
setwd("H:/Rspace/RE_Community/SolarLab")
Cam2001<- read.table("./data/project_label_BSRN_event_label_CAM_2001.tab",sep="\t", header=TRUE,stringsAsFactors=FALSE)
str(Cam2001)
library(lubridate)
Cam2001$Date.Time<-ymd_hms(Cam2001$Date.Time)
str(Cam2001)
Cam2001<-Cam2001[,-Cam2001$Origin.of.values]
Cam2001<-Cam2001[,-Cam2001$Origin.of.Values]
names(Cam2001)<-c("datetime","DIF","LWD","SWD","DIR","ORG")
Cam2001$Date.Time<-ymd_hms(Cam2001$datetime)
Cam2001$Date.Time<-ymd_hms(Cam2001$datetime)
str(Cam2001)
plot(DIR[1:1440],type="l")
attach(Cam2001)
plot(DIR[1:1440],type="l")
plot(datatime[1:1440]/60,DIR[1:1440],type="l")
plot(datetime[1:1440]/60,DIR[1:1440],type="l")
plot(datetime[1:1440],DIR[1:1440],type="l")
sol <- calcSol(lat, fBTd(mode = "prom"), sample = "hour",keep.night = FALSE)
library(solaR)
sol <- calcSol(lat, fBTd(mode = "prom"), sample = "hour",keep.night = FALSE)
lat<-50
sol <- calcSol(lat, fBTd(mode = "prom"), sample = "hour",keep.night = FALSE)
str(sol)
G0dm <- c(2.766, 3.491, 4.494, 5.912, 6.989, 7.742, 7.919, 7.027, 5.369,3.562, 2.814, 2.179) * 1000
Ta <- c(10, 14.1, 15.6, 17.2, 19.3, 21.2, 28.4, 29.9, 24.3, 18.2, 17.2,15.2)
BD <- readG0dm(G0dm = G0dm, Ta = Ta, lat = lat)
compD <- fCompD(sol, BD, corr = "Page")
compI <- fCompI(sol, compD)
plot(compD)
plot(compI)
lat<-50
sol <- calcSol(lat, fBTd(mode = "prom"), sample = "hour",keep.night = FALSE)
str(sol)
G0dm <- c(2.766, 3.491, 4.494, 5.912, 6.989, 7.742, 7.919, 7.027, 5.369,3.562, 2.814, 2.179) * 1000
Ta <- c(10, 14.1, 15.6, 17.2, 19.3, 21.2, 28.4, 29.9, 24.3, 18.2, 17.2,15.2)
BD <- readG0dm(G0dm = G0dm, Ta = Ta, lat = lat)
compD <- fCompD(sol, BD, corr = "Page")
compI <- fCompI(sol, compD)
lat<-37
sol <- calcSol(lat, fBTd(mode = "prom"), sample = "hour",keep.night = FALSE)
#str(sol)
G0dm <- c(2.766, 3.491, 4.494, 5.912, 6.989, 7.742, 7.919, 7.027, 5.369,3.562, 2.814, 2.179) * 1000
Ta <- c(10, 14.1, 15.6, 17.2, 19.3, 21.2, 28.4, 29.9, 24.3, 18.2, 17.2,15.2)
BD <- readG0dm(G0dm = G0dm, Ta = Ta, lat = lat)
compD <- fCompD(sol, BD, corr = "Page")
compI <- fCompI(sol, compD)
plot(compD)
plot(compI)
plot(DIR[1:7*1440],type="l")
setwd("H:/Rspace/RE_Community/SolarLab")
library(lubridate)
Cam2001<- read.table("./data/project_label_BSRN_event_label_CAM_2001.tab",sep="\t", header=TRUE,stringsAsFactors=FALSE)
str(Cam2001)
names(Cam2001)<-c("datetime","DIF","LWD","SWD","DIR","ORG")
# convert time to POSIXct
Cam2001$Date.Time<-ymd_hms(Cam2001$datetime)
attach(Cam2001)
plot(DIR[1:7*1440],type="l")
Npoint<-7*1440
plot(DIR[1:Npoint],type="l")
Npoint<-31*1440
plot(DIR[1:Npoint],type="l")
plot(SWD[1:Npoint],type="l")
Npoint<-7*1440
plot(SWD[1:Npoint],type="l")
day<-1
phi=(pi/180)*50
S0=1368
t=seq(1,366,length.out=365*1440)
daybegin<-day*1440
dayend<-(day+7)*1440
Q<-solarFlux(S0,phi,t)
deltaOdot<-function(t){
# t is the time in day number 1-365
#t<-t*365
asin(sin(-0.4091)*cos((2*pi/365.24)*(t+10)+0.0334*sin((2*pi/365.24)*(t-2))))
}
h0<-function(phi,t){
acos(tan(phi)*tan(deltaOdot(t)))
}
cosTheta<-function(phi,delta,h){
# theta is the zenith angle
sin(phi)*sin(delta)+cos(phi)*cos(delta)*cos(h)
}
solarFlux<-function(S0,phi,t){
h<-pi*(2*(t-floor(t))-1)
delta<-deltaOdot(t)
flux<-S0*cosTheta(phi,delta,h)
flux<-pmax(flux,rep(0,length(t)))
flux
}
day<-1
phi=(pi/180)*50
S0=1368
t=seq(1,366,length.out=365*1440)
daybegin<-day*1440
dayend<-(day+7)*1440
Q<-solarFlux(S0,phi,t)
?matplot
Npoint<-7*1440
plot(SWD[1:Npoint],type="l")
lines(Q[1;Npoint],type="l",col="blue")
lines(Q[1:Npoint],type="l",col="blue")
day<-180
phi=(pi/180)*50
S0=1368
t=seq(1,366,length.out=365*1440)
daybegin<-day*1440
dayend<-(day+7)*1440
Q<-solarFlux(S0,phi,t)
plot(SWD[daybegin:dayend],type="l")
lines(Q[daybegin:dayend],type="l",col="blue")
plot(SWD[daybegin:dayend],type="l",ylim=c(0,1500))
lines(Q[daybegin:dayend],type="l",col="blue")
day<-360
phi=(pi/180)*50
S0=1368
t=seq(1,366,length.out=365*1440)
daybegin<-day*1440
dayend<-(day+7)*1440
Q<-solarFlux(S0,phi,t)
plot(SWD[daybegin:dayend],type="l",ylim=c(0,1500))
lines(Q[daybegin:dayend],type="l",col="blue")
day<-260
phi=(pi/180)*50
S0=1368
t=seq(1,366,length.out=365*1440)
daybegin<-day*1440
dayend<-(day+7)*1440
Q<-solarFlux(S0,phi,t)
plot(SWD[daybegin:dayend],type="l",ylim=c(0,1500))
lines(Q[daybegin:dayend],type="l",col="blue")
day<-350
phi=(pi/180)*50
S0=1368
t=seq(1,366,length.out=365*1440)
daybegin<-day*1440
dayend<-(day+7)*1440
Q<-solarFlux(S0,phi,t)
plot(SWD[daybegin:dayend],type="l",ylim=c(0,1500))
lines(Q[daybegin:dayend],type="l",col="blue")
day<-300
phi=(pi/180)*50
S0=1368
t=seq(1,366,length.out=365*1440)
daybegin<-day*1440
dayend<-(day+7)*1440
Q<-solarFlux(S0,phi,t)
plot(SWD[daybegin:dayend],type="l",ylim=c(0,1500))
lines(Q[daybegin:dayend],type="l",col="blue")
day<-340
phi=(pi/180)*50
S0=1368
t=seq(1,366,length.out=365*1440)
daybegin<-day*1440
dayend<-(day+7)*1440
Q<-solarFlux(S0,phi,t)
plot(SWD[daybegin:dayend],type="l",ylim=c(0,1500))
lines(Q[daybegin:dayend],type="l",col="blue")
day<-320
phi=(pi/180)*50
S0=1368
t=seq(1,366,length.out=365*1440)
daybegin<-day*1440
dayend<-(day+7)*1440
Q<-solarFlux(S0,phi,t)
plot(SWD[daybegin:dayend],type="l",ylim=c(0,1500))
lines(Q[daybegin:dayend],type="l",col="blue")
day<-310
phi=(pi/180)*50
S0=1368
t=seq(1,366,length.out=365*1440)
daybegin<-day*1440
dayend<-(day+7)*1440
Q<-solarFlux(S0,phi,t)
plot(SWD[daybegin:dayend],type="l",ylim=c(0,1500))
lines(Q[daybegin:dayend],type="l",col="blue")
day<-301
phi=(pi/180)*50
S0=1368
t=seq(1,366,length.out=365*1440)
daybegin<-day*1440
dayend<-(day+7)*1440
Q<-solarFlux(S0,phi,t)
plot(SWD[daybegin:dayend],type="l",ylim=c(0,1500))
lines(Q[daybegin:dayend],type="l",col="blue")
day<-302
phi=(pi/180)*50
S0=1368
t=seq(1,366,length.out=365*1440)
daybegin<-day*1440
dayend<-(day+7)*1440
Q<-solarFlux(S0,phi,t)
plot(SWD[daybegin:dayend],type="l",ylim=c(0,1500))
lines(Q[daybegin:dayend],type="l",col="blue")
day<-305
phi=(pi/180)*50
S0=1368
t=seq(1,366,length.out=365*1440)
daybegin<-day*1440
dayend<-(day+7)*1440
Q<-solarFlux(S0,phi,t)
plot(SWD[daybegin:dayend],type="l",ylim=c(0,1500))
lines(Q[daybegin:dayend],type="l",col="blue")
######################################################################
day<-307
phi=(pi/180)*50
S0=1368
t=seq(1,366,length.out=365*1440)
daybegin<-day*1440
dayend<-(day+3)*1440
Q<-solarFlux(S0,phi,t)
plot(SWD[daybegin:dayend],type="l",ylim=c(0,1500))
lines(Q[daybegin:dayend],type="l",col="blue")
